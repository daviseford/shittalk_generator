var spawn=require("child_process").spawn,fs=require("fs"),path=require("path"),jar,exists=fs.exists||path.exists,lists=fs.readdirSync(path.join(__dirname,"../build"));lists.some(function(a){if(".jar"===path.extname(a))return jar=path.join(__dirname,"../build/",a),!0});exports.jar=jar;
var defaultOptions={charset:"utf8",type:"js"},validOptions={charset:1,type:1,"line-break":1,nomunge:1,"preserve-semi":1,"disable-optimizations":1},getString=function(a,b,c){exists(a,function(f){if(f){var g=path.extname(a).replace(".","");fs.readFile(a,"utf8",function(a,d){c.type=g;b(a,d,c)})}else b(null,a,c)})},filterOptions=function(a){Object.keys(a).forEach(function(b){validOptions[b]||delete a[b]});a.type=a.type||"js";a.charset=a.charset||"utf8";return a},compressString=function(a,b,c){b=filterOptions(b);
var f=["-jar",exports.jar],g="",e="",d;Object.keys(b).forEach(function(a){f.push("--"+a);b[a]&&!0!==b[a]&&f.push(b[a])});d=spawn("java",f,{stdio:["pipe","pipe","pipe"]});d.stdin.write(a);d.stdin.end();d.stdout.on("data",function(a){g+=a});d.stderr.on("data",function(a){e+=a});d.on("exit",function(){var a=null;-1<e.indexOf("[ERROR]")&&(a=e);c(a,g,e)})},compress=function(a,b,c){"function"===typeof b&&(c=b,b=defaultOptions);getString(a,function(a,b,e){compressString(b,e,c)},b)};exports.compress=compress;
exports.compressString=compressString;
